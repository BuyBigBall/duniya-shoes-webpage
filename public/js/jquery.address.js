(function($){$.address=(function(){var f=function(b){var e=$.extend($.Event(b),(function(){var a={},parameterNames=$.address.parameterNames();for(var i=0,l=parameterNames.length;i<l;i++){a[parameterNames[i]]=$.address.parameter(parameterNames[i])}return{value:$.address.value(),path:$.address.path(),pathNames:$.address.pathNames(),parameterNames:parameterNames,parameters:a,queryString:$.address.queryString()}}).call($.address));$($.address).trigger(e);return e},_array=function(a){return Array.prototype.slice.call(a)},_bind=function(a,b,c){$().bind.apply($($.address),Array.prototype.slice.call(arguments));return $.address},_unbind=function(a,b){$().unbind.apply($($.address),Array.prototype.slice.call(arguments));return $.address},_supportsState=function(){return(_h.pushState&&_opts.state!==UNDEFINED)},_hrefState=function(){return('/'+_l.pathname.replace(new RegExp(_opts.state),'')+_l.search+(_hrefHash()?'#'+_hrefHash():'')).replace(_re,'/')},_hrefHash=function(){var a=_l.href.indexOf('#');return a!=-1?_l.href.substr(a+1):''},_href=function(){return _supportsState()?_hrefState():_hrefHash()},_window=function(){try{return top.document!==UNDEFINED&&top.document.title!==UNDEFINED?top:window}catch(e){return window}},_js=function(){return'javascript'},_strict=function(a){a=a.toString();return(_opts.strict&&a.substr(0,1)!='/'?'/':'')+a},_cssint=function(a,b){return parseInt(a.css(b),10)},_listen=function(){if(!_silent){var a=_href(),diff=decodeURI(_value)!=decodeURI(a);if(diff){if(_msie&&_version<7){_l.reload()}else{if(_msie&&!_hashchange&&_opts.history){_st(_html,50)}_value=a;_update(FALSE)}}}},_update=function(a){_st(_track,10);return f(CHANGE).isDefaultPrevented()||f(a?INTERNAL_CHANGE:EXTERNAL_CHANGE).isDefaultPrevented()},_track=function(){if(_opts.tracker!=='null'&&_opts.tracker!==NULL){var a=$.isFunction(_opts.tracker)?_opts.tracker:_t[_opts.tracker],value=(_l.pathname+_l.search+($.address&&!_supportsState()?$.address.value():'')).replace(/\/\//,'/').replace(/^\/$/,'');if($.isFunction(a)){a(value)}else if($.isFunction(_t.urchinTracker)){_t.urchinTracker(value)}else if(_t.pageTracker!==UNDEFINED&&$.isFunction(_t.pageTracker._trackPageview)){_t.pageTracker._trackPageview(value)}else if(_t._gaq!==UNDEFINED&&$.isFunction(_t._gaq.push)){_t._gaq.push(['_trackPageview',decodeURI(value)])}}},_html=function(){var a=_js()+':'+FALSE+';document.open();document.writeln(\'<html><head><title>'+_d.title.replace(/\'/g,'\\\'')+'</title><script>var '+ID+' = "'+encodeURIComponent(_href()).replace(/\'/g,'\\\'')+(_d.domain!=_l.hostname?'";document.domain="'+_d.domain:'')+'";</'+'script></head></html>\');document.close();';if(_version<7){_frame.src=a}else{_frame.contentWindow.location.replace(a)}},_options=function(){if(_url&&_qi!=-1){var i,param,params=_url.substr(_qi+1).split('&');for(i=0;i<params.length;i++){param=params[i].split('=');if(/^(autoUpdate|history|strict|wrap)$/.test(param[0])){_opts[param[0]]=(isNaN(param[1])?/^(true|yes)$/i.test(param[1]):(parseInt(param[1],10)!==0))}if(/^(state|tracker)$/.test(param[0])){_opts[param[0]]=param[1]}}_url=NULL}_value=_href()},_load=function(){if(!_loaded){_loaded=TRUE;_options();$('a[rel*="address:"]').address();if(_opts.wrap){var b=$('body'),wrap=$('body > *').wrapAll('<div style="padding:'+(_cssint(b,'marginTop')+_cssint(b,'paddingTop'))+'px '+(_cssint(b,'marginRight')+_cssint(b,'paddingRight'))+'px '+(_cssint(b,'marginBottom')+_cssint(b,'paddingBottom'))+'px '+(_cssint(b,'marginLeft')+_cssint(b,'paddingLeft'))+'px;" />').parent().wrap('<div id="'+ID+'" style="height:100%;overflow:auto;position:relative;'+(_webkit&&!window.statusbar.visible?'resize:both;':'')+'" />');$('html, body').css({height:'100%',margin:0,padding:0,overflow:'hidden'});if(_webkit){$('<style type="text/css" />').appendTo('head').text('#'+ID+'::-webkit-resizer { background-color: #fff; }')}}if(_msie&&!_hashchange){var c=_d.getElementsByTagName('frameset')[0];_frame=_d.createElement((c?'':'i')+'frame');_frame.src=_js()+':'+FALSE;if(c){c.insertAdjacentElement('beforeEnd',_frame);c[c.cols?'cols':'rows']+=',0';_frame.noResize=TRUE;_frame.frameBorder=_frame.frameSpacing=0}else{_frame.style.display='none';_frame.style.width=_frame.style.height=0;_frame.tabIndex=-1;_d.body.insertAdjacentElement('afterBegin',_frame)}_st(function(){$(_frame).bind('load',function(){var a=_frame.contentWindow;_value=a[ID]!==UNDEFINED?a[ID]:'';if(_value!=_href()){_update(FALSE);_l.hash=_value}});if(_frame.contentWindow[ID]===UNDEFINED){_html()}},50)}_st(function(){f('init');_update(FALSE)},1);if(!_supportsState()){if((_msie&&_version>7)||(!_msie&&_hashchange)){if(_t.addEventListener){_t.addEventListener(HASH_CHANGE,_listen,FALSE)}else if(_t.attachEvent){_t.attachEvent('on'+HASH_CHANGE,_listen)}}else{_si(_listen,50)}}if('state'in window.history){$(window).trigger('popstate')}}},_popstate=function(){if(decodeURI(_value)!=decodeURI(_href())){_value=_href();_update(FALSE)}},_unload=function(){if(_t.removeEventListener){_t.removeEventListener(HASH_CHANGE,_listen,FALSE)}else if(_t.detachEvent){_t.detachEvent('on'+HASH_CHANGE,_listen)}},_uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf('compatible')<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||'',version:b[2]||'0'}},_detectBrowser=function(){var a={},matched=_uaMatch(navigator.userAgent);if(matched.browser){a[matched.browser]=true;a.version=matched.version}if(a.chrome){a.webkit=true}else if(a.webkit){a.safari=true}return a},UNDEFINED,NULL=null,ID='jQueryAddress',STRING='string',HASH_CHANGE='hashchange',INIT='init',CHANGE='change',INTERNAL_CHANGE='internalChange',EXTERNAL_CHANGE='externalChange',TRUE=true,FALSE=false,_opts={autoUpdate:TRUE,history:TRUE,strict:TRUE,wrap:FALSE},_browser=_detectBrowser(),_version=parseFloat(_browser.version),_webkit=_browser.webkit||_browser.safari,_msie=!$.support.opacity,_t=_window(),_d=_t.document,_h=_t.history,_l=_t.location,_si=setInterval,_st=setTimeout,_re=/\/{2,9}/g,_agent=navigator.userAgent,_hashchange='on'+HASH_CHANGE in _t,_frame,_form,_url=$('script:last').attr('src'),_qi=_url?_url.indexOf('?'):-1,_title=_d.title,_silent=FALSE,_loaded=FALSE,_juststart=TRUE,_updating=FALSE,_listeners={},_value=_href();if(_msie){_version=parseFloat(_agent.substr(_agent.indexOf('MSIE')+4));if(_d.documentMode&&_d.documentMode!=_version){_version=_d.documentMode!=8?7:8}var g=_d.onpropertychange;_d.onpropertychange=function(){if(g){g.call(_d)}if(_d.title!=_title&&_d.title.indexOf('#'+_href())!=-1){_d.title=_title}}}if(_h.navigationMode){_h.navigationMode='compatible'}if(document.readyState=='complete'){var h=setInterval(function(){if($.address){_load();clearInterval(h)}},50)}else{_options();$(_load)}$(window).bind('popstate',_popstate).bind('unload',_unload);return{bind:function(a,b,c){return _bind.apply(this,_array(arguments))},unbind:function(a,b){return _unbind.apply(this,_array(arguments))},init:function(a,b){return _bind.apply(this,[INIT].concat(_array(arguments)))},change:function(a,b){return _bind.apply(this,[CHANGE].concat(_array(arguments)))},internalChange:function(a,b){return _bind.apply(this,[INTERNAL_CHANGE].concat(_array(arguments)))},externalChange:function(a,b){return _bind.apply(this,[EXTERNAL_CHANGE].concat(_array(arguments)))},baseURL:function(){var a=_l.href;if(a.indexOf('#')!=-1){a=a.substr(0,a.indexOf('#'))}if(/\/$/.test(a)){a=a.substr(0,a.length-1)}return a},autoUpdate:function(a){if(a!==UNDEFINED){_opts.autoUpdate=a;return this}return _opts.autoUpdate},history:function(a){if(a!==UNDEFINED){_opts.history=a;return this}return _opts.history},state:function(a){if(a!==UNDEFINED){_opts.state=a;var b=_hrefState();if(_opts.state!==UNDEFINED){if(_h.pushState){if(b.substr(0,3)=='/#/'){_l.replace(_opts.state.replace(/^\/$/,'')+b.substr(2))}}else if(b!='/'&&b.replace(/^\/#/,'')!=_hrefHash()){_st(function(){_l.replace(_opts.state.replace(/^\/$/,'')+'/#'+b)},1)}}return this}return _opts.state},strict:function(a){if(a!==UNDEFINED){_opts.strict=a;return this}return _opts.strict},tracker:function(a){if(a!==UNDEFINED){_opts.tracker=a;return this}return _opts.tracker},wrap:function(a){if(a!==UNDEFINED){_opts.wrap=a;return this}return _opts.wrap},update:function(){_updating=TRUE;this.value(_value);_updating=FALSE;return this},title:function(a){if(a!==UNDEFINED){_st(function(){_title=_d.title=a;if(_juststart&&_frame&&_frame.contentWindow&&_frame.contentWindow.document){_frame.contentWindow.document.title=a;_juststart=FALSE}},50);return this}return _d.title},value:function(a){if(a!==UNDEFINED){a=_strict(a);if(a=='/'){a=''}if(_value==a&&!_updating){return}_value=a;if(_opts.autoUpdate||_updating){if(_update(TRUE)){return this}if(_supportsState()){_h[_opts.history?'pushState':'replaceState']({},'',_opts.state.replace(/\/$/,'')+(_value===''?'/':_value))}else{_silent=TRUE;if(_webkit){if(_opts.history){_l.hash='#'+_value}else{_l.replace('#'+_value)}}else if(_value!=_href()){if(_opts.history){_l.hash='#'+_value}else{_l.replace('#'+_value)}}if((_msie&&!_hashchange)&&_opts.history){_st(_html,50)}if(_webkit){_st(function(){_silent=FALSE},1)}else{_silent=FALSE}}}return this}return _strict(_value)},path:function(a){if(a!==UNDEFINED){var b=this.queryString(),hash=this.hash();this.value(a+(b?'?'+b:'')+(hash?'#'+hash:''));return this}return _strict(_value).split('#')[0].split('?')[0]},pathNames:function(){var a=this.path(),names=a.replace(_re,'/').split('/');if(a.substr(0,1)=='/'||a.length===0){names.splice(0,1)}if(a.substr(a.length-1,1)=='/'){names.splice(names.length-1,1)}return names},queryString:function(a){if(a!==UNDEFINED){var b=this.hash();this.value(this.path()+(a?'?'+a:'')+(b?'#'+b:''));return this}var c=_value.split('?');return c.slice(1,c.length).join('?').split('#')[0]},parameter:function(a,b,c){var i,params;if(b!==UNDEFINED){var d=this.parameterNames();params=[];b=b===UNDEFINED||b===NULL?'':b.toString();for(i=0;i<d.length;i++){var n=d[i],v=this.parameter(n);if(typeof v==STRING){v=[v]}if(n==a){v=(b===NULL||b==='')?[]:(c?v.concat([b]):[b])}for(var j=0;j<v.length;j++){params.push(n+'='+v[j])}}if($.inArray(a,d)==-1&&b!==NULL&&b!==''){params.push(a+'='+b)}this.queryString(params.join('&'));return this}b=this.queryString();if(b){var r=[];params=b.split('&');for(i=0;i<params.length;i++){var p=params[i].split('=');if(p[0]==a){r.push(p.slice(1).join('='))}}if(r.length!==0){return r.length!=1?r:r[0]}}},parameterNames:function(){var a=this.queryString(),names=[];if(a&&a.indexOf('=')!=-1){var b=a.split('&');for(var i=0;i<b.length;i++){var c=b[i].split('=')[0];if($.inArray(c,names)==-1){names.push(c)}}}return names},hash:function(a){if(a!==UNDEFINED){this.value(_value.split('#')[0]+(a?'#'+a:''));return this}var b=_value.split('#');return b.slice(1,b.length).join('#')}}})();$.fn.address=function(c){if(!this.data('address')){this.on('click',function(e){if(e.shiftKey||e.ctrlKey||e.metaKey||e.which==2){return true}var a=e.currentTarget;if($(a).is('a')){e.preventDefault();var b=c?c.call(a):/address:/.test($(a).attr('rel'))?$(a).attr('rel').split('address:')[1].split(' ')[0]:$.address.state()!==undefined&&!/^\/?$/.test($.address.state())?$(a).attr('href').replace(new RegExp('^(.*'+$.address.state()+'|\\.)'),''):$(a).attr('href').replace(/^(#\!?|\.)/,'');$.address.value(b)}}).on('submit',function(e){var a=e.currentTarget;if($(a).is('form')){e.preventDefault();var b=$(a).attr('action'),value=c?c.call(a):(b.indexOf('?')!=-1?b.replace(/&$/,''):b+'?')+$(a).serialize();$.address.value(value)}}).data('address',true)}return this}})(jQuery);